<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research & Talent Discovery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-active { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; }
        .result-card { transition: all 0.2s; }
        .result-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        .gradient-text { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white">
                <h1 class="text-3xl font-bold">🔬 Research & Talent Discovery</h1>
                <p class="text-blue-100 text-sm">Find papers, authors, and build your network</p>
            </div>

            <div id="configPanel" class="p-6 bg-slate-50 border-b">
                <h2 class="text-xl font-semibold mb-4">⚙️ Configuration</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-sm mb-1">Airtable API Key</label><input type="password" id="airtableKey" placeholder="patXXX" class="w-full px-3 py-2 border rounded-lg"></div>
                    <div><label class="block text-sm mb-1">Base ID</label><input type="text" id="airtableBase" placeholder="appXXX" class="w-full px-3 py-2 border rounded-lg"></div>
                    <div><label class="block text-sm mb-1">Publications Table</label><input type="text" id="pubTable" value="Conference Publications" class="w-full px-3 py-2 border rounded-lg"></div>
                    <div><label class="block text-sm mb-1">Candidates Table</label><input type="text" id="candTable" value="Candidates" class="w-full px-3 py-2 border rounded-lg"></div>
                </div>
                <button onclick="init()" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg">Connect</button>
            </div>

            <div id="modes" class="hidden">
                <div class="flex bg-slate-50">
                    <button onclick="setMode('papers')" id="tab1" class="tab-active flex-1 px-6 py-4 font-semibold">📄 Papers</button>
                    <button onclick="setMode('authors')" id="tab2" class="flex-1 px-6 py-4 font-semibold text-gray-600">👥 Authors</button>
                    <button onclick="setMode('similar')" id="tab3" class="flex-1 px-6 py-4 font-semibold text-gray-600">🎯 Similar</button>
                    <button onclick="setMode('network')" id="tab4" class="flex-1 px-6 py-4 font-semibold text-gray-600">🕸️ Network</button>
                </div>
                <div id="mode1" class="p-6"><textarea id="q1" rows="2" class="w-full border rounded p-2 mb-3" placeholder="Find papers on Mamba"></textarea><button onclick="searchPapers()" class="w-full bg-blue-600 text-white py-3 rounded-lg">Search</button></div>
                <div id="mode2" class="p-6 hidden"><textarea id="q2" rows="2" class="w-full border rounded p-2 mb-3" placeholder="Find authors working on SSMs"></textarea><button onclick="searchAuthors()" class="w-full bg-purple-600 text-white py-3 rounded-lg">Search</button></div>
                <div id="mode3" class="p-6 hidden"><p class="text-sm mb-3">Finds papers similar to P0/P1 ranked</p><button onclick="findSimilar()" class="w-full bg-green-600 text-white py-3 rounded-lg">Find Similar</button></div>
                <div id="mode4" class="p-6 hidden"><input id="q4" class="w-full border rounded p-2 mb-3" placeholder="Author name"><button onclick="discoverNet()" class="w-full bg-indigo-600 text-white py-3 rounded-lg">Map Network</button></div>
            </div>

            <div id="logs" class="p-6 bg-slate-50 border-t hidden"><h3 class="font-semibold mb-2">Logs</h3><div id="logBox" class="bg-white border rounded p-3 max-h-60 overflow-y-auto text-sm"></div></div>
            <div id="results" class="p-6 hidden"><h3 id="resTitle" class="text-xl font-bold mb-4"></h3><div id="resBox"></div></div>
        </div>
    </div>
    <script>
const cfg={key:'',base:'',pub:'',cand:''};
let fm={p:{title:'',abstract:'',authors:'',date:'',url:''},c:{name:''}};
function log(m,t='info'){document.getElementById('logs').classList.remove('hidden');const c={error:'red',success:'green',warning:'yellow'}[t]||'gray';document.getElementById('logBox').innerHTML+='<div class="text-'+c+'-600">'+m+'</div>';}
async function init(){cfg.key=document.getElementById('airtableKey').value.trim();cfg.base=document.getElementById('airtableBase').value.trim();cfg.pub=document.getElementById('pubTable').value.trim();cfg.cand=document.getElementById('candTable').value.trim();if(!cfg.key||!cfg.base)return alert('Enter credentials');try{log('Connecting...');const r=await fetch('https://api.airtable.com/v0/meta/bases/'+cfg.base+'/tables',{headers:{'Authorization':'Bearer '+cfg.key}});if(!r.ok)throw new Error('HTTP '+r.status);const d=await r.json();const pt=d.tables.find(t=>t.name===cfg.pub);if(pt){fm.p.title=(pt.fields.find(f=>f.name.toLowerCase().includes('title'))||{}).name||'';fm.p.abstract=(pt.fields.find(f=>f.name.toLowerCase().includes('abstract'))||{}).name||'';fm.p.authors=(pt.fields.find(f=>f.name.toLowerCase().includes('author')&&f.type!=='multipleRecordLinks')||{}).name||'';}const ct=d.tables.find(t=>t.name===cfg.cand);if(ct)fm.c.name=(ct.fields.find(f=>f.name.toLowerCase().includes('name'))||ct.fields[0]).name;document.getElementById('modes').classList.remove('hidden');log('Connected!','success');}catch(e){log('Error: '+e.message,'error');}}
function setMode(m){['tab1','tab2','tab3','tab4'].forEach((t,i)=>{document.getElementById(t).className=(m===['papers','authors','similar','network'][i]?'tab-active ':'')+'flex-1 px-6 py-4 font-semibold'+(m!=['papers','authors','similar','network'][i]?' text-gray-600':'');});['mode1','mode2','mode3','mode4'].forEach((d,i)=>{document.getElementById(d).classList[m===['papers','authors','similar','network'][i]?'remove':'add']('hidden');});}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
async function searchPapers(){const q=document.getElementById('q1').value.trim();if(!q)return;document.getElementById('logBox').innerHTML='';log('Searching papers...');const terms=extractTerms(q);const papers=[];for(let t of terms){const r=await arxiv(t,20);papers.push(...r);await sleep(1500);}showPapers(papers);await addPapers(papers);}
async function searchAuthors(){const q=document.getElementById('q2').value.trim();if(!q)return;document.getElementById('logBox').innerHTML='';log('Searching authors...');const terms=extractTerms(q);const amap={};for(let t of terms){const pps=await arxiv(t,30);pps.forEach(p=>{p.authors.split(',').forEach(a=>{const n=a.trim();if(n&&n!=='Unknown'){if(!amap[n])amap[n]={name:n,papers:[],topics:new Set()};amap[n].papers.push(p);amap[n].topics.add(t);}});});await sleep(2000);}const auths=Object.values(amap).filter(a=>a.papers.length>=3).map(a=>({name:a.name,paperCount:a.papers.length,topics:Array.from(a.topics),score:a.papers.length*a.topics.size})).sort((a,b)=>b.score-a.score).slice(0,20);showAuthors(auths);await addAuthors(auths);}
async function findSimilar(){document.getElementById('logBox').innerHTML='';log('Analyzing P0/P1...');try{const r=await fetch('https://api.airtable.com/v0/'+cfg.base+'/'+encodeURIComponent(cfg.pub)+'?filterByFormula=OR({Karan\'s Notes}="P0",{Karan\'s Notes}="P1")',{headers:{'Authorization':'Bearer '+cfg.key}});if(!r.ok)throw new Error('HTTP '+r.status);const d=await r.json();if(d.records.length===0)return log('No P0/P1 found','warning');const authors=[];const terms=[];d.records.forEach(rec=>{const aut=rec.fields[fm.p.authors]||'';aut.split(',').forEach(a=>authors.push(a.trim()));const txt=((rec.fields[fm.p.title]||'')+' '+(rec.fields[fm.p.abstract]||'')).toLowerCase();[/mamba/gi,/state space/gi,/s4/gi,/attention/gi].forEach(pat=>{const m=txt.match(pat);if(m)m.forEach(x=>terms.push(x.toLowerCase()));});});const acount={};authors.forEach(a=>{acount[a]=(acount[a]||0)+1;});const top=Object.keys(acount).sort((a,b)=>acount[b]-acount[a]).slice(0,5);const uterms=Array.from(new Set(terms)).slice(0,5);log('Top authors: '+top.join(', '));log('Key terms: '+uterms.join(', '));const papers=[];for(let a of top){const r=await arxiv('au:'+a,20);papers.push(...r);await sleep(2000);}for(let t of uterms){const r=await arxiv(t,20);papers.push(...r);await sleep(2000);}const uniq=Array.from(new Map(papers.map(p=>[p.title.toLowerCase(),p])).values());showPapers(uniq);await addPapers(uniq);}catch(e){log('Error: '+e.message,'error');}}
async function discoverNet(){const a=document.getElementById('q4').value.trim();if(!a)return;document.getElementById('logBox').innerHTML='';log('Mapping network for '+a);const net={authors:{}};net.authors[a]={name:a,level:0,papers:[]};const pps=await arxiv('au:'+a,50);net.authors[a].papers=pps;const collabs={};pps.forEach(p=>{p.authors.split(',').forEach(au=>{const n=au.trim();if(n&&n!==a&&n!=='Unknown'){if(!collabs[n])collabs[n]=0;collabs[n]++;}});});const top=Object.keys(collabs).filter(c=>collabs[c]>=2).sort((x,y)=>collabs[y]-collabs[x]).slice(0,10);log('Found '+top.length+' collaborators');for(let c of top)net.authors[c]={name:c,level:1,papers:[],collabCount:collabs[c]};showNetwork(net);await addAuthors(Object.values(net.authors).map(au=>({name:au.name,paperCount:au.papers.length,topics:[]})));}
function extractTerms(p){const t=[];const ids=p.match(/arxiv\.org\/abs\/(\d+\.\d+)/gi);if(ids)ids.forEach(id=>t.push('arxiv:'+id.replace(/arxiv\.org\/abs\//i,'')));const qt=p.match(/"([^"]+)"/g);if(qt)qt.forEach(q=>t.push(q.replace(/"/g,'')));const tech=p.match(/\b(mamba|ssm|s4|transformer|attention|architecture|lstm|rnn)\b/gi);if(tech)tech.forEach(x=>t.push(x.toLowerCase()));if(ids&&ids.length>0&&t.length===ids.length){t.push('state space model');t.push('sequential model');}return t.length>0?Array.from(new Set(t)):[p];}
async function arxiv(q,max){try{if(q.startsWith('arxiv:')){const id=q.replace('arxiv:','');const r=await fetch('https://export.arxiv.org/api/query?id_list='+id);const txt=await r.text();const xml=new DOMParser().parseFromString(txt,'text/xml');const e=xml.querySelector('entry');if(e){const t=e.querySelector('title')?.textContent.trim();const s=e.querySelector('summary')?.textContent.trim();const d=e.querySelector('published')?.textContent;const l=e.querySelector('id')?.textContent;const a=Array.from(e.querySelectorAll('author name')).map(x=>x.textContent);if(t&&s)return[{title:t,abstract:s,authors:a.join(', '),date:d?d.split('T')[0]:'',url:l,source:'arXiv'}];}return[];}let sq=q.startsWith('au:')?'au:'+encodeURIComponent(q.replace('au:','')):'all:'+encodeURIComponent(q);const r=await fetch('https://export.arxiv.org/api/query?search_query='+sq+'&start=0&max_results='+max+'&sortBy=submittedDate&sortOrder=descending');const txt=await r.text();const xml=new DOMParser().parseFromString(txt,'text/xml');const entries=xml.querySelectorAll('entry');const pps=[];entries.forEach(e=>{const t=e.querySelector('title')?.textContent.trim();const s=e.querySelector('summary')?.textContent.trim();const d=e.querySelector('published')?.textContent;const l=e.querySelector('id')?.textContent;const a=Array.from(e.querySelectorAll('author name')).map(x=>x.textContent);if(t&&s)pps.push({title:t,abstract:s,authors:a.join(', '),date:d?d.split('T')[0]:'',url:l,source:'arXiv'});});return pps;}catch(e){log('ArXiv error: '+e.message,'error');return[];}}
function showPapers(pps){document.getElementById('results').classList.remove('hidden');document.getElementById('resTitle').innerHTML='<span class="gradient-text">📄 Found '+pps.length+' Papers</span>';document.getElementById('resBox').innerHTML=pps.slice(0,30).map(p=>'<div class="result-card bg-white rounded-xl p-5 border-2 border-blue-100 mb-4 shadow-sm"><h4 class="font-bold text-lg text-blue-900 mb-2">'+esc(p.title)+'</h4><p class="text-sm text-gray-600 mb-3">'+esc(p.abstract.substring(0,250))+'...</p><div class="flex gap-3 text-xs"><span class="px-3 py-1 bg-blue-50 rounded-full">'+esc(p.authors.substring(0,50))+'</span><span class="px-3 py-1 bg-green-50 rounded-full">'+p.date+'</span></div></div>').join('');}
function showAuthors(auths){document.getElementById('results').classList.remove('hidden');document.getElementById('resTitle').innerHTML='<span class="gradient-text">👥 Found '+auths.length+' Authors</span>';document.getElementById('resBox').innerHTML=auths.map(a=>'<div class="result-card bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-5 border-2 border-purple-100 mb-4 shadow-sm"><h4 class="font-bold text-lg text-purple-900 mb-3">'+esc(a.name)+'</h4><div class="flex gap-3 text-sm mb-2"><span class="px-3 py-1 bg-white/70 rounded-full">📝 '+a.paperCount+' papers</span><span class="px-3 py-1 bg-white/70 rounded-full">⭐ '+a.score+'</span></div><div class="text-xs text-purple-700">'+esc(a.topics.join(', '))+'</div></div>').join('');}
function showNetwork(net){document.getElementById('results').classList.remove('hidden');document.getElementById('resTitle').innerHTML='<span class="gradient-text">🕸️ Network: '+Object.keys(net.authors).length+' researchers</span>';const lvls={};Object.values(net.authors).forEach(a=>{if(!lvls[a.level])lvls[a.level]=[];lvls[a.level].push(a);});let h='';Object.keys(lvls).sort().forEach(l=>{const cols=['bg-blue-50','bg-purple-50','bg-green-50'];h+='<div class="mb-4"><h4 class="font-bold mb-2">Level '+l+'</h4><div class="grid grid-cols-3 gap-3">';h+=lvls[l].map(a=>'<div class="result-card '+cols[parseInt(l)%3]+' rounded-lg p-4 border shadow-sm"><div class="font-semibold">'+esc(a.name)+'</div><div class="text-xs text-gray-600">'+a.papers.length+' papers'+(a.collabCount?' • '+a.collabCount+' collabs':'')+'</div></div>').join('');h+='</div></div>';});document.getElementById('resBox').innerHTML=h;}
function esc(txt){const d=document.createElement('div');d.textContent=txt;return d.innerHTML;}
async function addPapers(pps){log('Adding '+pps.length+' papers...');const ex=await fetchEx(cfg.pub);let add=0,skip=0;for(let p of pps){if(ex.has(p.title.toLowerCase())){skip++;continue;}try{const flds={};if(fm.p.title)flds[fm.p.title]=p.title;if(fm.p.abstract)flds[fm.p.abstract]=p.abstract;if(fm.p.authors)flds[fm.p.authors]=p.authors;if(fm.p.date)flds[fm.p.date]=p.date;if(fm.p.url)flds[fm.p.url]=p.url;const r=await fetch('https://api.airtable.com/v0/'+cfg.base+'/'+encodeURIComponent(cfg.pub),{method:'POST',headers:{'Authorization':'Bearer '+cfg.key,'Content-Type':'application/json'},body:JSON.stringify({fields:flds})});if(r.ok)add++;await sleep(300);}catch(e){log('Add error: '+e.message,'error');}}log('Added '+add+', skipped '+skip,'success');}
async function addAuthors(auths){log('Adding '+auths.length+' authors...');const ex=await fetchEx(cfg.cand,true);let add=0,skip=0;for(let a of auths){if(ex.has(a.name.toLowerCase())){skip++;continue;}try{const flds={};if(fm.c.name)flds[fm.c.name]=a.name;const r=await fetch('https://api.airtable.com/v0/'+cfg.base+'/'+encodeURIComponent(cfg.cand),{method:'POST',headers:{'Authorization':'Bearer '+cfg.key,'Content-Type':'application/json'},body:JSON.stringify({fields:flds})});if(r.ok)add++;await sleep(300);}catch(e){log('Add error: '+e.message,'error');}}log('Added '+add+', skipped '+skip,'success');}
async function fetchEx(tbl,isCand=false){try{const r=await fetch('https://api.airtable.com/v0/'+cfg.base+'/'+encodeURIComponent(tbl),{headers:{'Authorization':'Bearer '+cfg.key}});if(!r.ok)return new Set();const d=await r.json();const s=new Set();d.records.forEach(rec=>{const val=isCand?rec.fields[fm.c.name]:rec.fields[fm.p.title];if(val)s.add(val.toLowerCase().trim());});return s;}catch(e){return new Set();}}
    </script>
</body>
</html>